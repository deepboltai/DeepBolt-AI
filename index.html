<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepBolt - Intelligent Assistant</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@300;400;500;600;700&family=Roboto+Mono:wght@300;400;500;600&display=swap">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Google Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0d1117;
            color: #e6edf3;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Main App Container */
        .app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .app-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 24px;
            border-bottom: 1px solid #21262d;
            background: #161b22;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .menu-toggle {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #8b949e;
            transition: all 0.2s ease;
        }

        .menu-toggle:hover {
            background: #21262d;
            color: #e6edf3;
        }

        .header-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 500;
            color: #e6edf3;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #4285f4 0%, #34a853 25%, #fbbc05 50%, #ea4335 75%, #9333ea 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-icon svg {
            width: 18px;
            height: 18px;
            color: white;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .auth-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .google-login-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border: 1px solid #30363d;
            border-radius: 20px;
            background: #21262d;
            color: #e6edf3;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .google-login-btn:hover {
            background: #30363d;
            border-color: #484f58;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #4285f4;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
            font-size: 14px;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .logout-btn {
            padding: 6px 12px;
            border: 1px solid #30363d;
            border-radius: 16px;
            background: transparent;
            color: #8b949e;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .logout-btn:hover {
            background: #21262d;
            color: #e6edf3;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: -320px;
            top: 0;
            width: 320px;
            height: 100vh;
            background: #0d1117;
            border-right: 1px solid #21262d;
            transition: left 0.3s ease;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .sidebar.open {
            left: 0;
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid #21262d;
        }

        .new-chat-btn {
            width: 100%;
            padding: 12px 16px;
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 8px;
            color: #e6edf3;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .new-chat-btn:hover {
            background: #30363d;
            border-color: #484f58;
        }

        .conversations-section {
            flex: 1;
            padding: 16px 20px;
            overflow-y: auto;
        }

        .section-title {
            font-size: 12px;
            font-weight: 500;
            color: #8b949e;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .conversation-item {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #8b949e;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            word-break: break-word;
        }

        .conversation-item:hover {
            background: #21262d;
            color: #e6edf3;
        }

        .conversation-item.active {
            background: #1f2937;
            color: #4285f4;
            border-left: 3px solid #4285f4;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            padding: 0 24px;
        }

        /* Chat Messages */
        .chat-messages {
            flex: 1;
            padding: 40px 0;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        /* Welcome Screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            min-height: 60vh;
        }

        .welcome-greeting {
            font-size: 56px;
            font-weight: 400;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #4285f4 0%, #34a853 25%, #fbbc05 50%, #ea4335 75%, #9333ea 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.1;
        }

        .welcome-subtitle {
            font-size: 18px;
            color: #8b949e;
            margin-bottom: 48px;
            font-weight: 400;
        }

        .suggestions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            width: 100%;
            max-width: 700px;
        }

        .suggestion-card {
            background: #161b22;
            border: 1px solid #21262d;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .suggestion-card:hover {
            background: #21262d;
            border-color: #30363d;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }

        .suggestion-text {
            font-size: 15px;
            color: #e6edf3;
            line-height: 1.4;
            font-weight: 400;
        }

        /* Message Bubbles */
        .message {
            margin-bottom: 32px;
            animation: fadeInUp 0.3s ease;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 14px;
        }

        .message.user .message-avatar {
            background: #4285f4;
            color: white;
        }

        .message.ai .message-avatar {
            background: linear-gradient(135deg, #4285f4 0%, #34a853 25%, #fbbc05 50%, #ea4335 75%, #9333ea 100%);
            color: white;
        }

        .message-sender {
            font-size: 14px;
            font-weight: 500;
            color: #e6edf3;
        }

        .message-content {
            margin-left: 44px;
            font-size: 16px;
            line-height: 1.6;
            color: #e6edf3;
            word-wrap: break-word;
        }

        .message.user .message-content {
            background: #1f2937;
            border: 1px solid #374151;
            padding: 14px 18px;
            border-radius: 18px;
            border-top-left-radius: 4px;
            display: inline-block;
            max-width: fit-content;
        }

        .message-actions {
            margin-left: 44px;
            margin-top: 12px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .action-btn {
            background: transparent;
            border: 1px solid #30363d;
            cursor: pointer;
            padding: 6px;
            border-radius: 6px;
            transition: all 0.2s ease;
            color: #8b949e;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn:hover {
            background: #21262d;
            color: #e6edf3;
        }

        /* Code Blocks */
        .code-block {
            background: #0d1117;
            border: 1px solid #21262d;
            border-radius: 8px;
            margin: 16px 0;
            overflow: hidden;
        }

        .code-header {
            background: #21262d;
            padding: 12px 16px;
            border-bottom: 1px solid #30363d;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
            color: #8b949e;
        }

        .code-content {
            padding: 16px;
            font-family: 'Roboto Mono', 'SF Mono', monospace;
            font-size: 14px;
            color: #e6edf3;
            white-space: pre-wrap;
            overflow-x: auto;
            line-height: 1.5;
        }

        .copy-btn {
            background: transparent;
            border: 1px solid #30363d;
            border-radius: 6px;
            color: #8b949e;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .copy-btn:hover {
            background: #30363d;
            color: #e6edf3;
        }

        /* Typing Indicator */
        .typing-indicator {
            margin-bottom: 32px;
            animation: fadeInUp 0.3s ease;
        }

        .typing-content {
            margin-left: 44px;
            display: flex;
            gap: 4px;
            padding: 16px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4285f4;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        .typing-dot:nth-child(3) { animation-delay: 0s; }

        @keyframes typing {
            0%, 80%, 100% { 
                transform: scale(0.8); 
                opacity: 0.5; 
            }
            40% { 
                transform: scale(1.2); 
                opacity: 1; 
            }
        }

        /* Typing Animations */
        .typing-cursor {
            display: inline-block;
            background: #4285f4;
            animation: blink 1s infinite;
            width: 2px;
            height: 1em;
            margin-left: 1px;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* Syntax highlighting for code */
        .token.keyword { color: #ff7b72; }
        .token.string { color: #a5d6ff; }
        .token.comment { color: #8b949e; font-style: italic; }
        .token.number { color: #79c0ff; }
        .token.function { color: #d2a8ff; }
        .token.operator { color: #ff7b72; }
        .token.punctuation { color: #e6edf3; }
        .token.variable { color: #ffa657; }

        /* Input Area */
        .chat-input {
            padding: 24px 0 32px 0;
            position: relative;
        }

        .input-container {
            background: #161b22;
            border: 1px solid #21262d;
            border-radius: 26px;
            display: flex;
            align-items: flex-end;
            padding: 12px 16px;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .input-container:focus-within {
            border-color: #4285f4;
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.2);
        }

        .message-input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 16px;
            font-family: inherit;
            resize: none;
            min-height: 24px;
            max-height: 200px;
            overflow-y: auto;
            color: #e6edf3;
            background: transparent;
            line-height: 1.5;
        }

        .message-input::placeholder {
            color: #6e7681;
        }

        .input-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 12px;
        }

        .input-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            background: transparent;
        }

        .mic-btn {
            color: #8b949e;
        }

        .mic-btn:hover {
            background: #21262d;
            color: #e6edf3;
        }

        .mic-btn.listening {
            background: #ea4335;
            color: white;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .send-btn {
            background: #4285f4;
            color: white;
        }

        .send-btn:hover:not(:disabled) {
            background: #3367d6;
        }

        .send-btn:disabled {
            background: #21262d;
            color: #6e7681;
            cursor: not-allowed;
        }

        /* Overlay for sidebar */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 999;
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .app-header {
                padding: 12px 16px;
            }

            .main-content {
                padding: 0 16px;
            }

            .chat-messages {
                padding: 24px 0;
            }

            .welcome-greeting {
                font-size: 40px;
            }

            .welcome-subtitle {
                font-size: 16px;
                margin-bottom: 32px;
            }

            .suggestions-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .suggestion-card {
                padding: 16px;
            }

            .input-container {
                margin: 0 -8px;
            }

            .sidebar {
                width: 280px;
                left: -280px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #30363d;
            border-radius: 50%;
            border-top-color: #4285f4;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Guest notice */
        .guest-notice {
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            color: #e6edf3;
        }

        .guest-notice-icon {
            color: #fbbf24;
        }
    </style>
</head>
<body>
    <!-- Overlay for mobile sidebar -->
    <div class="overlay" id="overlay" onclick="closeSidebar()"></div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <button class="new-chat-btn" onclick="startNewChat()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    New chat
                </button>
            </div>
            
            <div class="conversations-section">
                <h3 class="section-title">Recent Chats</h3>
                <div id="conversationsList">
                    <!-- Conversations will be added here -->
                </div>
            </div>
        </div>

        <!-- Header -->
        <div class="app-header">
            <div class="header-left">
                <button class="menu-toggle" onclick="toggleSidebar()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <div class="header-logo">
                    <div class="logo-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                    </div>
                    DeepBolt
                </div>
            </div>
            <div class="header-right">
                <div class="auth-section" id="authSection">
                    <!-- Auth content will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Chat Messages -->
            <div class="chat-messages empty" id="chatMessages">
                <div class="welcome-screen" id="welcomeScreen">
                    <h1 class="welcome-greeting" id="welcomeGreeting">Hello</h1>
                    <p class="welcome-subtitle">How can I help you today?</p>
                    
                    <div id="guestNotice" class="guest-notice" style="display: none;">
                        <svg class="guest-notice-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/>
                        </svg>
                        <span>You're using DeepBolt as a guest. <button onclick="handleGoogleLogin()" style="color: #4285f4; background: none; border: none; cursor: pointer; text-decoration: underline;">Sign in with Google</button> to save your conversations.</span>
                    </div>
                    
                    <div class="suggestions-grid">
                        <div class="suggestion-card" onclick="suggestQuestion('Write a professional email for a job application')">
                            <div class="suggestion-text">Write a professional email for a job application</div>
                        </div>
                        <div class="suggestion-card" onclick="suggestQuestion('Explain quantum computing in simple terms')">
                            <div class="suggestion-text">Explain quantum computing in simple terms</div>
                        </div>
                        <div class="suggestion-card" onclick="suggestQuestion('Create a workout plan for beginners')">
                            <div class="suggestion-text">Create a workout plan for beginners</div>
                        </div>
                        <div class="suggestion-card" onclick="suggestQuestion('Help me write code for a web application')">
                            <div class="suggestion-text">Help me write code for a web application</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="chat-input">
                <div class="input-container">
                    <textarea 
                        class="message-input" 
                        id="messageInput" 
                        placeholder="Message DeepBolt..." 
                        rows="1" 
                        onkeydown="handleInputKeydown(event)"
                        oninput="handleInputChange()"
                    ></textarea>
                    <div class="input-actions">
                        <button class="input-btn mic-btn" id="micButton" onclick="toggleSpeechRecognition()" title="Voice input">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                <line x1="12" y1="19" x2="12" y2="23"></line>
                                <line x1="8" y1="23" x2="16" y2="23"></line>
                            </svg>
                        </button>
                        <button class="input-btn send-btn" id="sendButton" onclick="sendMessage()" disabled title="Send">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const chatMessages = document.getElementById('chatMessages');
        const welcomeScreen = document.getElementById('welcomeScreen');
        const welcomeGreeting = document.getElementById('welcomeGreeting');
        const micButton = document.getElementById('micButton');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const conversationsList = document.getElementById('conversationsList');
        const authSection = document.getElementById('authSection');
        const guestNotice = document.getElementById('guestNotice');

        // App State
        let currentUser = null;
        let currentChatId = null;
        let chats = {};
        let isListening = false;
        let recognition = null;
        let typingTimeouts = [];

        // Google OAuth Configuration
        const GOOGLE_CLIENT_ID = '830014077220-j75hho3bangr0hcg785mhbh4r8le1iom.apps.googleusercontent.com';

        // Initialize the app
        function init() {
            // Initialize Google Sign-In
            if (window.google) {
                window.google.accounts.id.initialize({
                    client_id: GOOGLE_CLIENT_ID,
                    callback: handleCredentialResponse,
                    auto_select: false,
                });
            }

            // Initialize speech recognition
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.continuous = false;
                recognition.interimResults = true;
                recognition.lang = 'en-US';

                recognition.onresult = function(event) {
                    const transcript = Array.from(event.results)
                        .map(result => result[0])
                        .map(result => result.transcript)
                        .join('');
                    
                    messageInput.value = transcript;
                    handleInputChange();
                };

                recognition.onend = function() {
                    setIsListening(false);
                };

                recognition.onerror = function(event) {
                    console.error('Speech recognition error', event.error);
                    setIsListening(false);
                };
            } else {
                micButton.style.display = 'none';
            }

            // Check for saved user
            const savedUser = localStorage.getItem('deepbolt-user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateAuthSection();
                updateUserProfile();
            } else {
                // Start as guest
                updateAuthSection();
                guestNotice.style.display = 'flex';
            }

            // Load chats and initialize
            loadChats();
        }

        // Google OAuth Functions
        function handleCredentialResponse(response) {
            try {
                // Decode the JWT payload
                const payload = JSON.parse(atob(response.credential.split('.')[1]));
                
                const userData = {
                    id: payload.sub,
                    name: payload.name,
                    email: payload.email,
                    picture: payload.picture
                };

                currentUser = userData;
                localStorage.setItem('deepbolt-user', JSON.stringify(userData));
                
                updateAuthSection();
                updateUserProfile();
                guestNotice.style.display = 'none';
                
                console.log('Google login successful:', userData);
            } catch (error) {
                console.error('Error parsing Google credential:', error);
            }
        }

        function handleGoogleLogin() {
            if (window.google) {
                window.google.accounts.id.prompt();
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('deepbolt-user');
            updateAuthSection();
            guestNotice.style.display = 'flex';
            
            // Reset welcome greeting
            welcomeGreeting.textContent = 'Hello';
            
            if (window.google) {
                window.google.accounts.id.disableAutoSelect();
            }
        }

        function updateAuthSection() {
            if (currentUser) {
                authSection.innerHTML = `
                    <div class="user-info">
                        <div class="user-avatar">
                            ${currentUser.picture ? 
                                `<img src="${currentUser.picture}" alt="${currentUser.name}">` : 
                                currentUser.name.charAt(0).toUpperCase()
                            }
                        </div>
                        <span style="font-size: 14px; color: #e6edf3;">${currentUser.name}</span>
                    </div>
                    <button class="logout-btn" onclick="logout()">
                        Sign out
                    </button>
                `;
            } else {
                authSection.innerHTML = `
                    <button class="google-login-btn" onclick="handleGoogleLogin()">
                        <svg width="16" height="16" viewBox="0 0 24 24">
                            <path d="M12.24 10.285V14.4h6.806c-.275 1.765-2.056 5.174-6.806 5.174-4.095 0-7.439-3.389-7.439-7.574s3.345-7.574 7.439-7.574c2.33 0 3.891.989 4.785 1.849l3.254-3.138C18.189 1.186 15.479 0 12.24 0c-6.635 0-12 5.365-12 12s5.365 12 12 12c6.926 0 11.52-4.869 11.52-11.726 0-.788-.085-1.39-.189-1.989H12.24z" fill="#4285F4"/>
                        </svg>
                        Sign in
                    </button>
                `;
            }
        }

        function updateUserProfile() {
            if (currentUser) {
                const firstName = currentUser.name.split(' ')[0];
                welcomeGreeting.textContent = `Hello, ${firstName}`;
            } else {
                welcomeGreeting.textContent = 'Hello';
            }
        }

        // Chat Functions
        function startNewChat() {
            currentChatId = 'chat-' + Date.now();
            chats[currentChatId] = {
                id: currentChatId,
                title: 'New Chat',
                messages: [],
                createdAt: new Date()
            };
            
            // Clear messages and show welcome screen
            chatMessages.classList.add('empty');
            chatMessages.innerHTML = '';
            chatMessages.appendChild(welcomeScreen);
            welcomeScreen.style.display = 'flex';
            
            updateConversationsList();
            saveChats();
            closeSidebar();
        }

        function updateConversationsList() {
            conversationsList.innerHTML = '';
            
            const sortedChats = Object.values(chats).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            sortedChats.forEach(chat => {
                const conversationItem = document.createElement('div');
                conversationItem.className = 'conversation-item';
                if (chat.id === currentChatId) {
                    conversationItem.classList.add('active');
                }
                
                conversationItem.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span>${chat.title}</span>
                `;
                
                conversationItem.addEventListener('click', () => {
                    loadChat(chat.id);
                });
                
                conversationsList.appendChild(conversationItem);
            });
        }

        function loadChats() {
            const savedChats = localStorage.getItem('deepbolt-chats');
            
            if (savedChats) {
                chats = JSON.parse(savedChats);
                updateConversationsList();
                
                const chatIds = Object.keys(chats);
                if (chatIds.length > 0) {
                    const sortedChats = Object.values(chats).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    loadChat(sortedChats[0].id);
                } else {
                    startNewChat();
                }
            } else {
                startNewChat();
            }
        }

        function loadChat(chatId) {
            currentChatId = chatId;
            const chat = chats[chatId];
            
            if (chat && chat.messages.length > 0) {
                welcomeScreen.style.display = 'none';
                chatMessages.classList.remove('empty');
                chatMessages.innerHTML = '';
                
                chat.messages.forEach(message => {
                    if (message.type === 'user') {
                        addUserMessage(message.content, false);
                    } else {
                        addAIMessage(message.content, false);
                    }
                });
            } else {
                chatMessages.classList.add('empty');
                chatMessages.innerHTML = '';
                chatMessages.appendChild(welcomeScreen);
                welcomeScreen.style.display = 'flex';
            }
            
            updateConversationsList();
            scrollToBottom();
            closeSidebar();
        }

        function saveChats() {
            if (currentUser) {
                localStorage.setItem('deepbolt-chats', JSON.stringify(chats));
            }
        }

        function sendMessage() {
            const message = messageInput.value.trim();
            if (message === '') return;
            
            if (chatMessages.classList.contains('empty')) {
                welcomeScreen.style.display = 'none';
                chatMessages.classList.remove('empty');
                chatMessages.innerHTML = '';
            }
            
            addUserMessage(message);
            messageInput.value = '';
            handleInputChange();
            
            if (currentChatId && chats[currentChatId]) {
                chats[currentChatId].messages.push({
                    type: 'user',
                    content: message,
                    timestamp: new Date()
                });
                
                if (chats[currentChatId].messages.length === 1) {
                    const firstFewWords = message.split(' ').slice(0, 6).join(' ');
                    chats[currentChatId].title = firstFewWords.length > 30 ? firstFewWords.substring(0, 30) + '...' : firstFewWords;
                }
                
                saveChats();
                updateConversationsList();
            }
            
            setTimeout(generateAIResponse, 800);
        }

        function generateAIResponse() {
            if (!currentChatId || !chats[currentChatId]) return;
            
            const lastMessage = chats[currentChatId].messages[chats[currentChatId].messages.length - 1].content;
            showTypingIndicator();
            
            const aiResponse = generateResponseContent(lastMessage);
            const delay = Math.min(4000, Math.max(2000, aiResponse.length * 20));
            
            setTimeout(() => {
                removeTypingIndicator();
                addAIMessage(aiResponse);
                
                if (currentChatId && chats[currentChatId]) {
                    chats[currentChatId].messages.push({
                        type: 'ai',
                        content: aiResponse,
                        timestamp: new Date()
                    });
                    saveChats();
                }
            }, delay);
        }

        function generateResponseContent(userMessage) {
            const msg = userMessage.toLowerCase();
            
            if (msg.includes('hello') || msg.includes('hi') || msg.includes('hey')) {
                const name = currentUser ? currentUser.name.split(' ')[0] : '';
                return `Hello${name ? ' ' + name : ''}! I'm DeepBolt AI, your intelligent assistant. I can help you with:

â€¢ **Writing & Communication** - Essays, emails, creative content
â€¢ **Programming & Development** - Code examples, debugging, explanations  
â€¢ **Learning & Research** - Explanations, analysis, problem-solving
â€¢ **Planning & Organization** - Project planning, task management
â€¢ **Creative Projects** - Ideas, brainstorming, design concepts

What would you like to work on today?`;
            }
            
            if (msg.includes('code') || msg.includes('javascript') || msg.includes('python') || msg.includes('programming')) {
                return `I'd be happy to help you with coding! Here's a JavaScript example to get started:

\`\`\`javascript
// Modern async function with error handling
async function fetchUserData(userId) {
    try {
        const response = await fetch(\`/api/users/\${userId}\`);
        
        if (!response.ok) {
            throw new Error(\`HTTP error! status: \${response.status}\`);
        }
        
        const userData = await response.json();
        console.log('User data:', userData);
        
        return userData;
    } catch (error) {
        console.error('Error fetching user data:', error);
        throw error;
    }
}

// Usage example
fetchUserData('123')
    .then(user => {
        console.log('Success:', user);
    })
    .catch(error => {
        console.log('Failed:', error.message);
    });
\`\`\`

This demonstrates:
- Modern async/await syntax
- Proper error handling
- Template literals
- RESTful API calls
- Clean code structure

What specific programming task would you like help with?`;
            }
            
            if (msg.includes('email') && msg.includes('job')) {
                return `Here's a professional job application email template:

**Subject: Application for [Position Title] - [Your Name]**

Dear Hiring Manager,

I am writing to express my strong interest in the [Position Title] role at [Company Name]. With my background in [relevant field/experience], I believe I would be a valuable addition to your team.

**Key qualifications:**
â€¢ [Relevant skill/experience 1]
â€¢ [Relevant skill/experience 2]  
â€¢ [Relevant skill/experience 3]

I have attached my resume for your review and would welcome the opportunity to discuss how my skills align with your needs.

Thank you for considering my application. I look forward to hearing from you.

Best regards,
[Your Name]
[Your Phone Number]
[Your Email Address]

**Tips:**
- Research the company and personalize your message
- Highlight 2-3 most relevant qualifications
- Keep it concise but professional
- Always proofread before sending
- Follow up appropriately if you don't hear back`;
            }
            
            if (msg.includes('quantum')) {
                return `**Quantum Computing Explained**

Quantum computing represents a fundamental shift in how we process information, leveraging quantum mechanical phenomena to solve problems exponentially faster than classical computers.

**Core Concepts:**

ðŸ”¹ **Qubits** - Unlike classical bits (0 or 1), qubits can exist in superposition (both 0 and 1 simultaneously)

ðŸ”¹ **Superposition** - Allows quantum systems to explore multiple solution paths simultaneously

ðŸ”¹ **Entanglement** - Qubits become mysteriously linked, where measuring one instantly affects its partner

ðŸ”¹ **Quantum Interference** - Amplifies correct solutions while canceling out incorrect ones

**Real-World Applications:**

**Drug Discovery** - Simulate complex molecular interactions impossible for classical computers

**Cryptography** - Both breaking current encryption and creating quantum-safe security

**Financial Modeling** - Optimize portfolios and risk analysis with unprecedented accuracy

**Machine Learning** - Train AI models exponentially faster

**Current Limitations:**
- Quantum states are extremely fragile (decoherence)
- Requires near absolute zero temperatures
- High error rates require quantum error correction
- Limited to specific problem types

Think of it as nature's way of computing - using the fundamental properties of reality itself to process information in ways we're only beginning to understand.`;
            }
            
            if (msg.includes('workout') && msg.includes('beginner')) {
                return `**Complete Beginner Workout Plan**

Here's a progressive 6-week program designed to build a strong foundation:

**Phase 1: Weeks 1-2 (Building Base)**
*3 sessions per week, rest days between*

**Warm-up (8-10 minutes):**
â€¢ 3 minutes light walking/marching
â€¢ Dynamic stretches: arm circles, leg swings
â€¢ 2 minutes bodyweight movements

**Main Workout (25-30 minutes):**
â€¢ **Bodyweight Squats**: 3 sets of 8-12
â€¢ **Wall Push-ups**: 3 sets of 8-15  
â€¢ **Assisted Lunges**: 3 sets of 6-10 each leg
â€¢ **Modified Plank**: 3 sets of 15-30 seconds
â€¢ **Seated Shoulder Press**: 3 sets of 10-15

**Phase 2: Weeks 3-4 (Progression)**
â€¢ **Regular Squats**: 3 sets of 12-18
â€¢ **Incline Push-ups**: 3 sets of 8-15
â€¢ **Forward Lunges**: 3 sets of 10-12 each leg
â€¢ **Standard Plank**: 3 sets of 30-60 seconds
â€¢ **Glute Bridges**: 3 sets of 15-20

**Phase 3: Weeks 5-6 (Strength Building)**
â€¢ **Jump Squats**: 3 sets of 8-12
â€¢ **Standard Push-ups**: 3 sets of 8-15
â€¢ **Reverse Lunges**: 3 sets of 10-15 each leg
â€¢ **Plank to Downward Dog**: 3 sets of 8-12
â€¢ **Single-leg Glute Bridges**: 3 sets of 8-12 each leg

**Cool-down (10 minutes):**
â€¢ Full-body stretching routine
â€¢ Deep breathing exercises
â€¢ Mindful relaxation

**Success Tips:**
âœ“ Focus on form over speed - quality beats quantity
âœ“ Progress gradually - increase difficulty only when current level feels easy
âœ“ Stay consistent - missing one day is fine, missing two isn't
âœ“ Listen to your body - soreness is normal, pain is not
âœ“ Track your progress to stay motivated

Would you like me to customize this plan for your specific goals or equipment?`;
            }

            return `I understand you're asking about: "${userMessage}"

As your AI assistant, I can help you dive deeper into this topic. Here's how I can assist:

â€¢ **Detailed Explanations** - Break down complex concepts step-by-step
â€¢ **Practical Examples** - Show real-world applications and use cases  
â€¢ **Implementation Guidance** - Provide actionable steps and best practices
â€¢ **Alternative Approaches** - Explore different methods and perspectives
â€¢ **Resource Recommendations** - Suggest tools, books, or next learning steps

What specific aspect would you like me to focus on? I can provide more targeted assistance once I understand your particular needs or goals.`;
        }

        // Message Functions
        function addUserMessage(message, animate = true) {
            const messageElement = document.createElement('div');
            messageElement.className = 'message user';
            if (!animate) messageElement.style.animation = 'none';
            
            messageElement.innerHTML = `
                <div class="message-header">
                    <div class="message-avatar">
                        ${currentUser && currentUser.picture ? 
                            `<img src="${currentUser.picture}" alt="${currentUser.name}">` : 
                            (currentUser ? currentUser.name.charAt(0).toUpperCase() : 'G')
                        }
                    </div>
                    <span class="message-sender">You</span>
                </div>
                <div class="message-content">${escapeHtml(message)}</div>
                <div class="message-actions">
                    <button class="action-btn copy-btn" title="Copy" onclick="copyToClipboard('${escapeHtml(message).replace(/'/g, "\\'")}', this)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                    </button>
                </div>
            `;
            
            chatMessages.appendChild(messageElement);
            scrollToBottom();
        }

        function addAIMessage(message, animate = true) {
            const messageElement = document.createElement('div');
            messageElement.className = 'message ai';
            if (!animate) messageElement.style.animation = 'none';
            
            const messageContentDiv = document.createElement('div');
            messageContentDiv.innerHTML = `
                <div class="message-header">
                    <div class="message-avatar">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                    </div>
                    <span class="message-sender">DeepBolt</span>
                </div>
                <div class="message-content" id="ai-content-${Date.now()}"></div>
                <div class="message-actions">
                    <button class="action-btn copy-btn" title="Copy" onclick="copyToClipboard('${escapeHtml(message).replace(/'/g, "\\'")}', this)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2 2v1"></path>
                        </svg>
                    </button>
                </div>
            `;
            
            chatMessages.appendChild(messageContentDiv);
            
            if (animate) {
                const contentElement = messageContentDiv.querySelector('.message-content');
                animateResponse(message, contentElement);
            } else {
                const contentElement = messageContentDiv.querySelector('.message-content');
                contentElement.innerHTML = formatResponse(message);
            }
            
            scrollToBottom();
        }

        function animateResponse(text, element) {
            // Check if the text contains code blocks
            if (text.includes('```')) {
                animateResponseWithCode(text, element);
            } else {
                // ChatGPT-style typing for regular text
                animateTyping(text, element, 30);
            }
        }

        function animateResponseWithCode(text, element) {
            const parts = text.split('```');
            let currentIndex = 0;
            
            function animatePart() {
                if (currentIndex >= parts.length) return;
                
                const part = parts[currentIndex];
                const isCode = currentIndex % 2 === 1;
                
                if (isCode) {
                    // DeepSeek-style code animation
                    const lines = part.split('\n');
                    const language = lines[0] || 'javascript';
                    const code = lines.slice(1).join('\n');
                    
                    const codeBlockDiv = document.createElement('div');
                    codeBlockDiv.className = 'code-block';
                    codeBlockDiv.innerHTML = `
                        <div class="code-header">
                            <span>${language}</span>
                            <button class="copy-btn" onclick="copyCodeToClipboard('${escapeHtml(code).replace(/'/g, "\\'")}', this)">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                                Copy
                            </button>
                        </div>
                        <div class="code-content" id="code-${Date.now()}"></div>
                    `;
                    element.appendChild(codeBlockDiv);
                    
                    const codeElement = codeBlockDiv.querySelector('.code-content');
                    animateCode(code, codeElement, () => {
                        currentIndex++;
                        animatePart();
                    });
                } else {
                    // Regular text animation
                    const textDiv = document.createElement('div');
                    element.appendChild(textDiv);
                    animateTyping(part, textDiv, 30, () => {
                        currentIndex++;
                        animatePart();
                    });
                }
            }
            
            animatePart();
        }

        function animateTyping(text, element, speed = 30, callback = null) {
            let index = 0;
            const formattedText = formatResponse(text);
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = formattedText;
            const plainText = tempDiv.textContent || tempDiv.innerText || '';
            
            function typeCharacter() {
                if (index < plainText.length) {
                    const char = plainText[index];
                    const currentContent = element.textContent || '';
                    element.innerHTML = formatResponse(currentContent + char) + '<span class="typing-cursor"></span>';
                    
                    index++;
                    const delay = char === '.' || char === '!' || char === '?' ? speed * 3 : speed;
                    setTimeout(typeCharacter, delay);
                } else {
                    element.innerHTML = formattedText;
                    if (callback) callback();
                }
                scrollToBottom();
            }
            
            typeCharacter();
        }

        function animateCode(code, element, callback = null) {
            let index = 0;
            const lines = code.split('\n');
            
            function typeLine(lineIndex) {
                if (lineIndex >= lines.length) {
                    if (callback) callback();
                    return;
                }
                
                const line = lines[lineIndex];
                let charIndex = 0;
                
                function typeChar() {
                    if (charIndex < line.length) {
                        const currentContent = element.textContent || '';
                        const newChar = line[charIndex];
                        element.innerHTML = highlightSyntax(currentContent + newChar) + '<span class="typing-cursor"></span>';
                        
                        charIndex++;
                        setTimeout(typeChar, Math.random() * 50 + 20); // Variable speed for realistic feel
                    } else {
                        // Add newline and continue to next line
                        const currentContent = element.textContent || '';
                        element.innerHTML = highlightSyntax(currentContent + '\n');
                        setTimeout(() => typeLine(lineIndex + 1), 200);
                    }
                    scrollToBottom();
                }
                
                typeChar();
            }
            
            typeLine(0);
        }

        function highlightSyntax(code) {
            return code
                .replace(/\b(function|const|let|var|if|else|for|while|return|import|export|class|async|await|try|catch|throw|new)\b/g, '<span class="token keyword">$1</span>')
                .replace(/(['"`])((?:(?!\1)[^\\]|\\.)*)?\1/g, '<span class="token string">$1$2$1</span>')
                .replace(/\/\/.*$/gm, '<span class="token comment">$&</span>')
                .replace(/\/\*[\s\S]*?\*\//g, '<span class="token comment">$&</span>')
                .replace(/\b\d+\.?\d*\b/g, '<span class="token number">$&</span>')
                .replace(/\b(\w+)(?=\()/g, '<span class="token function">$1</span>')
                .replace(/[+\-*/%=<>!&|]/g, '<span class="token operator">$&</span>')
                .replace(/[{}[\]();,.:]/g, '<span class="token punctuation">$&</span>');
        }

        function showTypingIndicator() {
            const typingElement = document.createElement('div');
            typingElement.className = 'typing-indicator';
            typingElement.id = 'typingIndicator';
            
            typingElement.innerHTML = `
                <div class="message-header">
                    <div class="message-avatar">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                    </div>
                    <span class="message-sender">DeepBolt</span>
                </div>
                <div class="typing-content">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            
            chatMessages.appendChild(typingElement);
            scrollToBottom();
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function suggestQuestion(question) {
            messageInput.value = question;
            handleInputChange();
            messageInput.focus();
        }

        // UI Functions
        function toggleSidebar() {
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }

        function closeSidebar() {
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
        }

        function setIsListening(listening) {
            isListening = listening;
            if (listening) {
                micButton.classList.add('listening');
            } else {
                micButton.classList.remove('listening');
            }
        }

        function toggleSpeechRecognition() {
            if (!recognition) return;
            
            if (isListening) {
                recognition.stop();
                setIsListening(false);
            } else {
                recognition.start();
                setIsListening(true);
            }
        }

        function handleInputKeydown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function handleInputChange() {
            messageInput.style.height = 'auto';
            messageInput.style.height = Math.min(messageInput.scrollHeight, 200) + 'px';
            sendButton.disabled = messageInput.value.trim() === '';
        }

        function scrollToBottom() {
            setTimeout(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 10);
        }

        function formatResponse(text) {
            // Handle code blocks separately
            if (text.includes('```')) {
                return text; // Will be handled by animateResponseWithCode
            }
            
            // Convert markdown-style formatting
            text = escapeHtml(text)
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/^â€¢ (.+)$/gm, '<div style="margin: 4px 0; padding-left: 16px;">â€¢ $1</div>')
                .replace(/^ðŸ”¹ \*\*(.*?)\*\*/gm, '<div style="margin: 8px 0; padding-left: 16px; font-weight: 500;">ðŸ”¹ <strong>$1</strong></div>')
                .replace(/^âœ“ (.+)$/gm, '<div style="margin: 4px 0; padding-left: 16px; color: #34a853;">âœ“ $1</div>');
            
            return text;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function copyToClipboard(text, button) {
            const cleanText = text.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&').replace(/&quot;/g, '"').replace(/&#x27;/g, "'");
            
            navigator.clipboard.writeText(cleanText).then(() => {
                const originalContent = button.innerHTML;
                button.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                `;
                
                setTimeout(() => {
                    button.innerHTML = originalContent;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }

        function copyCodeToClipboard(code, button) {
            const cleanCode = code.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&').replace(/&quot;/g, '"').replace(/&#x27;/g, "'");
            
            navigator.clipboard.writeText(cleanCode).then(() => {
                const originalContent = button.innerHTML;
                button.innerHTML = `
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    Copied
                `;
                
                setTimeout(() => {
                    button.innerHTML = originalContent;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy code:', err);
            });
        }

        // Initialize the app when page loads
        window.addEventListener('load', init);
        
        // Initialize when Google API loads
        window.addEventListener('google-loaded', init);
    </script>
</body>
</html>
